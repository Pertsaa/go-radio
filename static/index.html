<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Go Radio</title>

    <link rel="icon" href="favicon.png" />
    <link rel="stylesheet" href="index.css" />

    <script
      src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1"
      type="module"
    ></script>
  </head>

  <body class="text-sm bg-neutral-950 text-slate-50 select-none">
    <main class="flex flex-col">
      <div
        class="fixed flex items-center justify-between h-[64px] overflow-hidden gap-2 px-6 top-0 left-0 right-0 bg-neutral-950 border-b border-neutral-800"
      >
        <div class="flex gap-2 items-center whitespace-nowrap">
          <img src="favicon.png" width="64" height="32" />
          <h1 class="font-semibold text-base leading-16">Go Radio</h1>
        </div>
      </div>

      <div
        class="fixed left-0 top-[64px] bottom-[64px] flex px-6 flex-col gap-2 w-[112px] py-6"
      >
        <button
          data-active="true"
          onclick="handlePlayChannel('k&s')"
          class="text-[10px] data-active:text-green-500 p-4 rounded bg-neutral-900 hover:bg-neutral-900 transition-all cursor-pointer flex items-center justify-center"
        >
          K&S
        </button>
        <button
          onclick="handlePlayChannel('hp')"
          class="text-[10px] p-4 rounded bg-neutral-950 hover:bg-neutral-900 transition-all cursor-pointer flex items-center justify-center"
        >
          HP
        </button>
        <button
          onclick="handlePlayChannel('lkl')"
          class="text-[10px] p-4 rounded bg-neutral-950 hover:bg-neutral-900 transition-all cursor-pointer flex items-center justify-center"
        >
          LKL
        </button>
      </div>

      <div class="my-[64px] flex flex-col py-6 ml-[64px] sm:px-12">
        <div class="flex gap-2 items-center">
          <button
            class="rounded size-8 flex items-center justify-center border border-neutral-800 bg-green-500 text-slate-50 hover:bg-green-600 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-play-icon lucide-play"
            >
              <path
                d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"
              />
            </svg>
          </button>

          <button
            class="rounded size-8 flex items-center justify-center border border-neutral-800 bg-neutral-950 hover:bg-neutral-800 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-shuffle-icon lucide-shuffle"
            >
              <path d="m18 14 4 4-4 4" />
              <path d="m18 2 4 4-4 4" />
              <path
                d="M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22"
              />
              <path d="M2 6h1.972a4 4 0 0 1 3.6 2.2" />
              <path d="M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45" />
            </svg>
          </button>
        </div>

        <ul id="file-list" class="flex flex-col pt-4"></ul>

        <div
          id="stream-controls"
          class="fixed data-hidden:hidden bg-neutral-950 bottom-0 left-0 right-0 h-[64px] px-4 border-t border-neutral-800 flex gap-2 items-center mx-auto py-2"
        >
          <button
            id="mute-button"
            onclick="handleMute()"
            data-hidden="true"
            class="rounded data-hidden:hidden size-8 flex items-center justify-center border border-neutral-800 bg-neutral-950 hover:bg-neutral-800 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-pause-icon lucide-pause"
            >
              <rect x="14" y="3" width="5" height="18" rx="1" />
              <rect x="5" y="3" width="5" height="18" rx="1" />
            </svg>
          </button>

          <button
            id="unmute-button"
            onclick="handleUnmute()"
            class="rounded data-hidden:hidden size-8 flex items-center justify-center border border-neutral-800 bg-neutral-950 hover:bg-neutral-800 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-play-icon lucide-play"
            >
              <path
                d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"
              />
            </svg>
          </button>

          <audio id="audio-player" preload="auto">
            Your browser does not support the audio element.
          </audio>

          <h2 id="stream-file-name"></h2>

          <button
            id="stop-button"
            onclick="handleStop()"
            class="ml-auto rounded size-8 border flex items-center justify-center border-neutral-800 bg-neutral-950 hover:bg-neutral-800 cursor-pointer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-x-icon lucide-x"
            >
              <path d="M18 6 6 18" />
              <path d="m6 6 12 12" />
            </svg>
          </button>
        </div>
      </div>
    </main>
  </body>
</html>

<script>
  const radioState = {
    stream_file: null,
  };

  const streamFileName = document.getElementById("stream-file-name");

  const muteButton = document.getElementById("mute-button");
  const unmuteButton = document.getElementById("unmute-button");

  const audioPlayer = document.getElementById("audio-player");

  function handlePlayChannel(channelId) {
    audioPlayer.pause();
    audioPlayer.src = "";

    // channel1Button.classList.remove('active');
    // channel2Button.classList.remove('active');

    // Set the new audio source
    const url = `http://localhost:8080/api/radio/${channelId}/stream`;
    audioPlayer.src = url;

    // if (channel === 'channel1') {
    // 	channel1Button.classList.add('active');
    // } else {
    // 	channel2Button.classList.add('active');
    // }

    // Reload and play the audio
    audioPlayer.load();
    audioPlayer
      .play()
      .then(() => console.log(`playing channel: ${channelId}`))
      .catch((error) => console.error("Playback error:", error));
  }

  async function handleMute() {
    radioState.paused = true;
    muteButton.setAttribute("data-hidden", true);
    unmuteButton.removeAttribute("data-hidden");
  }

  async function handleUnmute() {
    radioState.paused = false;
    muteButton.removeAttribute("data-hidden");
    unmuteButton.setAttribute("data-hidden", true);
  }

  async function handleStop() {}

  async function init() {
    const response = await fetch("/api/radio/status");
    const status = await response.json();
    console.log(status);
  }

  init();
</script>
